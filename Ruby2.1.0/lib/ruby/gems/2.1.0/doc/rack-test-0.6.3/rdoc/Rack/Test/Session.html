<!DOCTYPE html>

<html>
<head>
<meta charset="UTF-8">

<title>class Rack::Test::Session - rack-test-0.6.3 Documentation</title>

<link href="../../fonts.css" rel="stylesheet">
<link href="../../rdoc.css" rel="stylesheet">

<script type="text/javascript">
  var rdoc_rel_prefix = "../../";
</script>

<script src="../../js/jquery.js"></script>
<script src="../../js/navigation.js"></script>
<script src="../../js/search_index.js"></script>
<script src="../../js/search.js"></script>
<script src="../../js/searcher.js"></script>
<script src="../../js/darkfish.js"></script>


<body id="top" role="document" class="class">
<nav role="navigation">
  <div id="project-navigation">
    <div id="home-section" role="region" title="Quick navigation" class="nav-section">
  <h2>
    <a href="../../index.html" rel="home">Home</a>
  </h2>

  <div id="table-of-contents-navigation">
    <a href="../../table_of_contents.html#pages">Pages</a>
    <a href="../../table_of_contents.html#classes">Classes</a>
    <a href="../../table_of_contents.html#methods">Methods</a>
  </div>
</div>

    <div id="search-section" role="search" class="project-section initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <div id="search-field-wrapper">
      <input id="search-field" role="combobox" aria-label="Search"
             aria-autocomplete="list" aria-controls="search-results"
             type="text" name="search" placeholder="Search" spellcheck="false"
             title="Type to search, Up and Down to navigate, Enter to load">
    </div>

    <ul id="search-results" aria-label="Search Results"
        aria-busy="false" aria-expanded="false"
        aria-atomic="false" class="initially-hidden"></ul>
  </form>
</div>

  </div>

  

  <div id="class-metadata">
    
    <div id="parent-class-section" class="nav-section">
  <h3>Parent</h3>

  
  <p class="link">Object
  
</div>

    <div id="includes-section" class="nav-section">
  <h3>Included Modules</h3>

  <ul class="link-list">
  
  
    <li><a class="include" href="Utils.html">Rack::Test::Utils</a>
  
  
  </ul>
</div>

    <div id="extends-section" class="nav-section">
  <h3>Extended With Modules</h3>

  <ul class="link-list">
    
  
    <li><span class="extend">Forwardable</span>
  
  
  </ul>
</div>

    <!-- Method Quickref -->
<div id="method-list-section" class="nav-section">
  <h3>Methods</h3>

  <ul class="link-list" role="directory">
    
    <li ><a href="#method-c-new">::new</a>
    
    <li ><a href="#method-i-authorize">#authorize</a>
    
    <li ><a href="#method-i-basic_authorize">#basic_authorize</a>
    
    <li ><a href="#method-i-default_env">#default_env</a>
    
    <li ><a href="#method-i-delete">#delete</a>
    
    <li ><a href="#method-i-digest_auth_configured-3F">#digest_auth_configured?</a>
    
    <li ><a href="#method-i-digest_auth_header">#digest_auth_header</a>
    
    <li ><a href="#method-i-digest_authorize">#digest_authorize</a>
    
    <li ><a href="#method-i-env">#env</a>
    
    <li ><a href="#method-i-env_for">#env_for</a>
    
    <li ><a href="#method-i-follow_redirect-21">#follow_redirect!</a>
    
    <li ><a href="#method-i-get">#get</a>
    
    <li ><a href="#method-i-head">#head</a>
    
    <li ><a href="#method-i-header">#header</a>
    
    <li ><a href="#method-i-headers_for_env">#headers_for_env</a>
    
    <li ><a href="#method-i-options">#options</a>
    
    <li ><a href="#method-i-params_to_string">#params_to_string</a>
    
    <li ><a href="#method-i-patch">#patch</a>
    
    <li ><a href="#method-i-post">#post</a>
    
    <li ><a href="#method-i-process_request">#process_request</a>
    
    <li ><a href="#method-i-put">#put</a>
    
    <li ><a href="#method-i-request">#request</a>
    
    <li ><a href="#method-i-retry_with_digest_auth-3F">#retry_with_digest_auth?</a>
    
  </ul>
</div>

  </div>
</nav>

<main role="main" aria-labelledby="class-Rack::Test::Session">
  <h1 id="class-Rack::Test::Session" class="class">
    class Rack::Test::Session
  </h1>

  <section class="description">
    
<p>This class represents a series of requests issued to a Rack app, sharing a
single cookie jar</p>

<p>Rack::Test::Session&#39;s methods are most often called through <a
href="Methods.html">Rack::Test::Methods</a>, which will automatically build
a session when it&#39;s first used.</p>

  </section>

  
  
  
  <section id="5Buntitled-5D" class="documentation-section">
    

    

    

    

    
     <section id="public-class-5Buntitled-5D-method-details" class="method-section">
       <header>
         <h3>Public Class Methods</h3>
       </header>

    
      <div id="method-c-new" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">new</span><span
            class="method-args">(mock_session)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Creates a <a href="Session.html">Rack::Test::Session</a> for a given Rack
app or <a href="../MockSession.html">Rack::MockSession</a>.</p>

<p>Note: Generally, you won&#39;t need to initialize a <a
href="Session.html">Rack::Test::Session</a> directly. Instead, you should
include <a href="Methods.html">Rack::Test::Methods</a> into your testing
context. (See <a href="../../README_rdoc.html">README.rdoc</a> for an
example)</p>
          
          

          
          <div class="method-source-code" id="new-source">
            <pre><span class="ruby-comment"># File lib/rack/test.rb, line 36</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">initialize</span>(<span class="ruby-identifier">mock_session</span>)
  <span class="ruby-ivar">@headers</span> = {}
  <span class="ruby-ivar">@env</span> = {}

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">mock_session</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">MockSession</span>)
    <span class="ruby-ivar">@rack_mock_session</span> = <span class="ruby-identifier">mock_session</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-ivar">@rack_mock_session</span> = <span class="ruby-constant">MockSession</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">mock_session</span>)
  <span class="ruby-keyword">end</span>

  <span class="ruby-ivar">@default_host</span> = <span class="ruby-ivar">@rack_mock_session</span>.<span class="ruby-identifier">default_host</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
    </section>
  
     <section id="public-instance-5Buntitled-5D-method-details" class="method-section">
       <header>
         <h3>Public Instance Methods</h3>
       </header>

    
      <div id="method-i-authorize" class="method-detail method-alias">
        
        <div class="method-heading">
          <span class="method-name">authorize</span><span
            class="method-args">(username, password)</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
        </div>

        

        
        <div class="aliases">
          Alias for: <a href="Session.html#method-i-basic_authorize">basic_authorize</a>
        </div>
        
      </div>

    
      <div id="method-i-basic_authorize" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">basic_authorize</span><span
            class="method-args">(username, password)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Set the username and password for HTTP Basic authorization, to be included
in subsequent requests in the HTTP_AUTHORIZATION header.</p>

<p>Example:</p>

<pre>basic_authorize &quot;bryan&quot;, &quot;secret&quot;</pre>
          
          

          
          <div class="method-source-code" id="basic_authorize-source">
            <pre><span class="ruby-comment"># File lib/rack/test.rb, line 161</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">basic_authorize</span>(<span class="ruby-identifier">username</span>, <span class="ruby-identifier">password</span>)
  <span class="ruby-identifier">encoded_login</span> = [<span class="ruby-node">&quot;#{username}:#{password}&quot;</span>].<span class="ruby-identifier">pack</span>(<span class="ruby-string">&quot;m*&quot;</span>)
  <span class="ruby-identifier">header</span>(<span class="ruby-string">&#39;Authorization&#39;</span>, <span class="ruby-node">&quot;Basic #{encoded_login}&quot;</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        
        <div class="aliases">
          Also aliased as: <a href="Session.html#method-i-authorize">authorize</a>
        </div>
        

        
      </div>

    
      <div id="method-i-delete" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">delete</span><span
            class="method-args">(uri, params = {}, env = {}, &block)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Issue a DELETE request for the given URI. See <a
href="Session.html#method-i-get">get</a></p>

<p>Example:</p>

<pre>delete &quot;/&quot;</pre>
          
          

          
          <div class="method-source-code" id="delete-source">
            <pre><span class="ruby-comment"># File lib/rack/test.rb, line 92</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">delete</span>(<span class="ruby-identifier">uri</span>, <span class="ruby-identifier">params</span> = {}, <span class="ruby-identifier">env</span> = {}, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
  <span class="ruby-identifier">env</span> = <span class="ruby-identifier">env_for</span>(<span class="ruby-identifier">uri</span>, <span class="ruby-identifier">env</span>.<span class="ruby-identifier">merge</span>(<span class="ruby-value">:method</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;DELETE&quot;</span>, <span class="ruby-value">:params</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>))
  <span class="ruby-identifier">process_request</span>(<span class="ruby-identifier">uri</span>, <span class="ruby-identifier">env</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-digest_authorize" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">digest_authorize</span><span
            class="method-args">(username, password)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Set the username and password for HTTP Digest authorization, to be included
in subsequent requests in the HTTP_AUTHORIZATION header.</p>

<p>Example:</p>

<pre>digest_authorize &quot;bryan&quot;, &quot;secret&quot;</pre>
          
          

          
          <div class="method-source-code" id="digest_authorize-source">
            <pre><span class="ruby-comment"># File lib/rack/test.rb, line 173</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">digest_authorize</span>(<span class="ruby-identifier">username</span>, <span class="ruby-identifier">password</span>)
  <span class="ruby-ivar">@digest_username</span> = <span class="ruby-identifier">username</span>
  <span class="ruby-ivar">@digest_password</span> = <span class="ruby-identifier">password</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-env" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">env</span><span
            class="method-args">(name, value)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Set an env var to be included on all subsequent requests through the
session. Use a value of nil to remove a previously configured env.</p>

<p>Example:</p>

<pre class="ruby"><span class="ruby-identifier">env</span> <span class="ruby-string">&quot;rack.session&quot;</span>, {:<span class="ruby-identifier">csrf</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;token&#39;</span>}
</pre>
          
          

          
          <div class="method-source-code" id="env-source">
            <pre><span class="ruby-comment"># File lib/rack/test.rb, line 148</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">env</span>(<span class="ruby-identifier">name</span>, <span class="ruby-identifier">value</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">value</span>.<span class="ruby-identifier">nil?</span>
    <span class="ruby-ivar">@env</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">name</span>)
  <span class="ruby-keyword">else</span>
    <span class="ruby-ivar">@env</span>[<span class="ruby-identifier">name</span>] = <span class="ruby-identifier">value</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-follow_redirect-21" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">follow_redirect!</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Rack::Test will not follow any redirects automatically. This method will
follow the redirect returned (including setting the Referer header on the
new request) in the last response. If the last response was not a redirect,
an error will be raised.</p>
          
          

          
          <div class="method-source-code" id="follow_redirect-21-source">
            <pre><span class="ruby-comment"># File lib/rack/test.rb, line 182</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">follow_redirect!</span>
  <span class="ruby-keyword">unless</span> <span class="ruby-identifier">last_response</span>.<span class="ruby-identifier">redirect?</span>
    <span class="ruby-identifier">raise</span> <span class="ruby-constant">Error</span>.<span class="ruby-identifier">new</span>(<span class="ruby-string">&quot;Last response was not a redirect. Cannot follow_redirect!&quot;</span>)
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">get</span>(<span class="ruby-identifier">last_response</span>[<span class="ruby-string">&quot;Location&quot;</span>], {}, { <span class="ruby-string">&quot;HTTP_REFERER&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">last_request</span>.<span class="ruby-identifier">url</span> })
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-get" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">get</span><span
            class="method-args">(uri, params = {}, env = {}, &block)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Issue a GET request for the given URI with the given params and Rack
environment. Stores the issues request object in last_request and the
app&#39;s response in last_response. Yield last_response to a block if
given.</p>

<p>Example:</p>

<pre>get &quot;/&quot;</pre>
          
          

          
          <div class="method-source-code" id="get-source">
            <pre><span class="ruby-comment"># File lib/rack/test.rb, line 56</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">get</span>(<span class="ruby-identifier">uri</span>, <span class="ruby-identifier">params</span> = {}, <span class="ruby-identifier">env</span> = {}, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
  <span class="ruby-identifier">env</span> = <span class="ruby-identifier">env_for</span>(<span class="ruby-identifier">uri</span>, <span class="ruby-identifier">env</span>.<span class="ruby-identifier">merge</span>(<span class="ruby-value">:method</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;GET&quot;</span>, <span class="ruby-value">:params</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>))
  <span class="ruby-identifier">process_request</span>(<span class="ruby-identifier">uri</span>, <span class="ruby-identifier">env</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-head" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">head</span><span
            class="method-args">(uri, params = {}, env = {}, &block)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Issue a HEAD request for the given URI. See <a
href="Session.html#method-i-get">get</a></p>

<p>Example:</p>

<pre>head &quot;/&quot;</pre>
          
          

          
          <div class="method-source-code" id="head-source">
            <pre><span class="ruby-comment"># File lib/rack/test.rb, line 110</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">head</span>(<span class="ruby-identifier">uri</span>, <span class="ruby-identifier">params</span> = {}, <span class="ruby-identifier">env</span> = {}, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
  <span class="ruby-identifier">env</span> = <span class="ruby-identifier">env_for</span>(<span class="ruby-identifier">uri</span>, <span class="ruby-identifier">env</span>.<span class="ruby-identifier">merge</span>(<span class="ruby-value">:method</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;HEAD&quot;</span>, <span class="ruby-value">:params</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>))
  <span class="ruby-identifier">process_request</span>(<span class="ruby-identifier">uri</span>, <span class="ruby-identifier">env</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-header" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">header</span><span
            class="method-args">(name, value)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Set a header to be included on all subsequent requests through the session.
Use a value of nil to remove a previously configured header.</p>

<p>In accordance with the Rack spec, headers will be included in the Rack
environment hash in HTTP_USER_AGENT form.</p>

<p>Example:</p>

<pre>header &quot;User-Agent&quot;, &quot;Firefox&quot;</pre>
          
          

          
          <div class="method-source-code" id="header-source">
            <pre><span class="ruby-comment"># File lib/rack/test.rb, line 135</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">header</span>(<span class="ruby-identifier">name</span>, <span class="ruby-identifier">value</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">value</span>.<span class="ruby-identifier">nil?</span>
    <span class="ruby-ivar">@headers</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">name</span>)
  <span class="ruby-keyword">else</span>
    <span class="ruby-ivar">@headers</span>[<span class="ruby-identifier">name</span>] = <span class="ruby-identifier">value</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-options" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">options</span><span
            class="method-args">(uri, params = {}, env = {}, &block)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Issue an OPTIONS request for the given URI. See <a
href="Session.html#method-i-get">get</a></p>

<p>Example:</p>

<pre>options &quot;/&quot;</pre>
          
          

          
          <div class="method-source-code" id="options-source">
            <pre><span class="ruby-comment"># File lib/rack/test.rb, line 101</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">options</span>(<span class="ruby-identifier">uri</span>, <span class="ruby-identifier">params</span> = {}, <span class="ruby-identifier">env</span> = {}, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
  <span class="ruby-identifier">env</span> = <span class="ruby-identifier">env_for</span>(<span class="ruby-identifier">uri</span>, <span class="ruby-identifier">env</span>.<span class="ruby-identifier">merge</span>(<span class="ruby-value">:method</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;OPTIONS&quot;</span>, <span class="ruby-value">:params</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>))
  <span class="ruby-identifier">process_request</span>(<span class="ruby-identifier">uri</span>, <span class="ruby-identifier">env</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-patch" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">patch</span><span
            class="method-args">(uri, params = {}, env = {}, &block)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Issue a PATCH request for the given URI. See <a
href="Session.html#method-i-get">get</a></p>

<p>Example:</p>

<pre>patch &quot;/&quot;</pre>
          
          

          
          <div class="method-source-code" id="patch-source">
            <pre><span class="ruby-comment"># File lib/rack/test.rb, line 83</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">patch</span>(<span class="ruby-identifier">uri</span>, <span class="ruby-identifier">params</span> = {}, <span class="ruby-identifier">env</span> = {}, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
  <span class="ruby-identifier">env</span> = <span class="ruby-identifier">env_for</span>(<span class="ruby-identifier">uri</span>, <span class="ruby-identifier">env</span>.<span class="ruby-identifier">merge</span>(<span class="ruby-value">:method</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;PATCH&quot;</span>, <span class="ruby-value">:params</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>))
  <span class="ruby-identifier">process_request</span>(<span class="ruby-identifier">uri</span>, <span class="ruby-identifier">env</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-post" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">post</span><span
            class="method-args">(uri, params = {}, env = {}, &block)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Issue a POST request for the given URI. See <a
href="Session.html#method-i-get">get</a></p>

<p>Example:</p>

<pre class="ruby"><span class="ruby-identifier">post</span> <span class="ruby-string">&quot;/signup&quot;</span>, <span class="ruby-string">&quot;name&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;Bryan&quot;</span>
</pre>
          
          

          
          <div class="method-source-code" id="post-source">
            <pre><span class="ruby-comment"># File lib/rack/test.rb, line 65</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">post</span>(<span class="ruby-identifier">uri</span>, <span class="ruby-identifier">params</span> = {}, <span class="ruby-identifier">env</span> = {}, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
  <span class="ruby-identifier">env</span> = <span class="ruby-identifier">env_for</span>(<span class="ruby-identifier">uri</span>, <span class="ruby-identifier">env</span>.<span class="ruby-identifier">merge</span>(<span class="ruby-value">:method</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;POST&quot;</span>, <span class="ruby-value">:params</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>))
  <span class="ruby-identifier">process_request</span>(<span class="ruby-identifier">uri</span>, <span class="ruby-identifier">env</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-put" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">put</span><span
            class="method-args">(uri, params = {}, env = {}, &block)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Issue a PUT request for the given URI. See <a
href="Session.html#method-i-get">get</a></p>

<p>Example:</p>

<pre>put &quot;/&quot;</pre>
          
          

          
          <div class="method-source-code" id="put-source">
            <pre><span class="ruby-comment"># File lib/rack/test.rb, line 74</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">put</span>(<span class="ruby-identifier">uri</span>, <span class="ruby-identifier">params</span> = {}, <span class="ruby-identifier">env</span> = {}, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
  <span class="ruby-identifier">env</span> = <span class="ruby-identifier">env_for</span>(<span class="ruby-identifier">uri</span>, <span class="ruby-identifier">env</span>.<span class="ruby-identifier">merge</span>(<span class="ruby-value">:method</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;PUT&quot;</span>, <span class="ruby-value">:params</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>))
  <span class="ruby-identifier">process_request</span>(<span class="ruby-identifier">uri</span>, <span class="ruby-identifier">env</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-request" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">request</span><span
            class="method-args">(uri, env = {}, &block)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Issue a request to the Rack app for the given URI and optional Rack
environment. Stores the issues request object in last_request and the
app&#39;s response in last_response. Yield last_response to a block if
given.</p>

<p>Example:</p>

<pre>request &quot;/&quot;</pre>
          
          

          
          <div class="method-source-code" id="request-source">
            <pre><span class="ruby-comment"># File lib/rack/test.rb, line 122</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">request</span>(<span class="ruby-identifier">uri</span>, <span class="ruby-identifier">env</span> = {}, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
  <span class="ruby-identifier">env</span> = <span class="ruby-identifier">env_for</span>(<span class="ruby-identifier">uri</span>, <span class="ruby-identifier">env</span>)
  <span class="ruby-identifier">process_request</span>(<span class="ruby-identifier">uri</span>, <span class="ruby-identifier">env</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
    </section>
  
     <section id="private-instance-5Buntitled-5D-method-details" class="method-section">
       <header>
         <h3>Private Instance Methods</h3>
       </header>

    
      <div id="method-i-default_env" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">default_env</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="default_env-source">
            <pre><span class="ruby-comment"># File lib/rack/test.rb, line 287</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">default_env</span>
  { <span class="ruby-string">&quot;rack.test&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">true</span>, <span class="ruby-string">&quot;REMOTE_ADDR&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;127.0.0.1&quot;</span> }.<span class="ruby-identifier">merge</span>(<span class="ruby-ivar">@env</span>).<span class="ruby-identifier">merge</span>(<span class="ruby-identifier">headers_for_env</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-digest_auth_configured-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">digest_auth_configured?</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="digest_auth_configured-3F-source">
            <pre><span class="ruby-comment"># File lib/rack/test.rb, line 283</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">digest_auth_configured?</span>
  <span class="ruby-ivar">@digest_username</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-digest_auth_header" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">digest_auth_header</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="digest_auth_header-source">
            <pre><span class="ruby-comment"># File lib/rack/test.rb, line 260</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">digest_auth_header</span>
  <span class="ruby-identifier">challenge</span> = <span class="ruby-identifier">last_response</span>[<span class="ruby-string">&quot;WWW-Authenticate&quot;</span>].<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot; &quot;</span>, <span class="ruby-value">2</span>).<span class="ruby-identifier">last</span>
  <span class="ruby-identifier">params</span> = <span class="ruby-constant">Rack</span><span class="ruby-operator">::</span><span class="ruby-constant">Auth</span><span class="ruby-operator">::</span><span class="ruby-constant">Digest</span><span class="ruby-operator">::</span><span class="ruby-constant">Params</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-identifier">challenge</span>)

  <span class="ruby-identifier">params</span>.<span class="ruby-identifier">merge!</span>({
    <span class="ruby-string">&quot;username&quot;</span>  =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@digest_username</span>,
    <span class="ruby-string">&quot;nc&quot;</span>        =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;00000001&quot;</span>,
    <span class="ruby-string">&quot;cnonce&quot;</span>    =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;nonsensenonce&quot;</span>,
    <span class="ruby-string">&quot;uri&quot;</span>       =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">last_request</span>.<span class="ruby-identifier">fullpath</span>,
    <span class="ruby-string">&quot;method&quot;</span>    =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">last_request</span>.<span class="ruby-identifier">env</span>[<span class="ruby-string">&quot;REQUEST_METHOD&quot;</span>],
  })

  <span class="ruby-identifier">params</span>[<span class="ruby-string">&quot;response&quot;</span>] = <span class="ruby-constant">MockDigestRequest</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">params</span>).<span class="ruby-identifier">response</span>(<span class="ruby-ivar">@digest_password</span>)

  <span class="ruby-node">&quot;Digest #{params}&quot;</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-env_for" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">env_for</span><span
            class="method-args">(path, env)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="env_for-source">
            <pre><span class="ruby-comment"># File lib/rack/test.rb, line 192</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">env_for</span>(<span class="ruby-identifier">path</span>, <span class="ruby-identifier">env</span>)
  <span class="ruby-identifier">uri</span> = <span class="ruby-constant">URI</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-identifier">path</span>)
  <span class="ruby-identifier">uri</span>.<span class="ruby-identifier">path</span> = <span class="ruby-node">&quot;/#{uri.path}&quot;</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">uri</span>.<span class="ruby-identifier">path</span>[<span class="ruby-value">0</span>] <span class="ruby-operator">==</span> <span class="ruby-value">?/</span>
  <span class="ruby-identifier">uri</span>.<span class="ruby-identifier">host</span> <span class="ruby-operator">||=</span> <span class="ruby-ivar">@default_host</span>

  <span class="ruby-identifier">env</span> = <span class="ruby-identifier">default_env</span>.<span class="ruby-identifier">merge</span>(<span class="ruby-identifier">env</span>)

  <span class="ruby-identifier">env</span>[<span class="ruby-string">&quot;HTTP_HOST&quot;</span>] <span class="ruby-operator">||=</span> [<span class="ruby-identifier">uri</span>.<span class="ruby-identifier">host</span>, (<span class="ruby-identifier">uri</span>.<span class="ruby-identifier">port</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">uri</span>.<span class="ruby-identifier">port</span> <span class="ruby-operator">!=</span> <span class="ruby-identifier">uri</span>.<span class="ruby-identifier">default_port</span>)].<span class="ruby-identifier">compact</span>.<span class="ruby-identifier">join</span>(<span class="ruby-string">&quot;:&quot;</span>)

  <span class="ruby-identifier">env</span>.<span class="ruby-identifier">update</span>(<span class="ruby-string">&quot;HTTPS&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;on&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-constant">URI</span><span class="ruby-operator">::</span><span class="ruby-constant">HTTPS</span> <span class="ruby-operator">===</span> <span class="ruby-identifier">uri</span>
  <span class="ruby-identifier">env</span>[<span class="ruby-string">&quot;HTTP_X_REQUESTED_WITH&quot;</span>] = <span class="ruby-string">&quot;XMLHttpRequest&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">env</span>[<span class="ruby-value">:xhr</span>]

  <span class="ruby-comment"># TODO: Remove this after Rack 1.1 has been released.</span>
  <span class="ruby-comment"># Stringifying and upcasing methods has be commit upstream</span>
  <span class="ruby-identifier">env</span>[<span class="ruby-string">&quot;REQUEST_METHOD&quot;</span>] <span class="ruby-operator">||=</span> <span class="ruby-identifier">env</span>[<span class="ruby-value">:method</span>] <span class="ruby-operator">?</span> <span class="ruby-identifier">env</span>[<span class="ruby-value">:method</span>].<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">upcase</span> <span class="ruby-operator">:</span> <span class="ruby-string">&quot;GET&quot;</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">env</span>[<span class="ruby-string">&quot;REQUEST_METHOD&quot;</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;GET&quot;</span>
    <span class="ruby-comment"># merge :params with the query string</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span> = <span class="ruby-identifier">env</span>[<span class="ruby-value">:params</span>]
      <span class="ruby-identifier">params</span> = <span class="ruby-identifier">parse_nested_query</span>(<span class="ruby-identifier">params</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">String</span>)
      <span class="ruby-identifier">params</span>.<span class="ruby-identifier">update</span>(<span class="ruby-identifier">parse_nested_query</span>(<span class="ruby-identifier">uri</span>.<span class="ruby-identifier">query</span>))
      <span class="ruby-identifier">uri</span>.<span class="ruby-identifier">query</span> = <span class="ruby-identifier">build_nested_query</span>(<span class="ruby-identifier">params</span>)
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">elsif</span> <span class="ruby-operator">!</span><span class="ruby-identifier">env</span>.<span class="ruby-identifier">has_key?</span>(<span class="ruby-value">:input</span>)
    <span class="ruby-identifier">env</span>[<span class="ruby-string">&quot;CONTENT_TYPE&quot;</span>] <span class="ruby-operator">||=</span> <span class="ruby-string">&quot;application/x-www-form-urlencoded&quot;</span>

    <span class="ruby-keyword">if</span> <span class="ruby-identifier">env</span>[<span class="ruby-value">:params</span>].<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Hash</span>)
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">data</span> = <span class="ruby-identifier">build_multipart</span>(<span class="ruby-identifier">env</span>[<span class="ruby-value">:params</span>])
        <span class="ruby-identifier">env</span>[<span class="ruby-value">:input</span>] = <span class="ruby-identifier">data</span>
        <span class="ruby-identifier">env</span>[<span class="ruby-string">&quot;CONTENT_LENGTH&quot;</span>] <span class="ruby-operator">||=</span> <span class="ruby-identifier">data</span>.<span class="ruby-identifier">length</span>.<span class="ruby-identifier">to_s</span>
        <span class="ruby-identifier">env</span>[<span class="ruby-string">&quot;CONTENT_TYPE&quot;</span>] = <span class="ruby-node">&quot;multipart/form-data; boundary=#{MULTIPART_BOUNDARY}&quot;</span>
      <span class="ruby-keyword">else</span>
        <span class="ruby-identifier">env</span>[<span class="ruby-value">:input</span>] = <span class="ruby-identifier">params_to_string</span>(<span class="ruby-identifier">env</span>[<span class="ruby-value">:params</span>])
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">env</span>[<span class="ruby-value">:input</span>] = <span class="ruby-identifier">env</span>[<span class="ruby-value">:params</span>]
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">env</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-value">:params</span>)

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">env</span>.<span class="ruby-identifier">has_key?</span>(<span class="ruby-value">:cookie</span>)
    <span class="ruby-identifier">set_cookie</span>(<span class="ruby-identifier">env</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-value">:cookie</span>), <span class="ruby-identifier">uri</span>)
  <span class="ruby-keyword">end</span>

  <span class="ruby-constant">Rack</span><span class="ruby-operator">::</span><span class="ruby-constant">MockRequest</span>.<span class="ruby-identifier">env_for</span>(<span class="ruby-identifier">uri</span>.<span class="ruby-identifier">to_s</span>, <span class="ruby-identifier">env</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-headers_for_env" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">headers_for_env</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="headers_for_env-source">
            <pre><span class="ruby-comment"># File lib/rack/test.rb, line 291</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">headers_for_env</span>
  <span class="ruby-identifier">converted_headers</span> = {}

  <span class="ruby-ivar">@headers</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">name</span>, <span class="ruby-identifier">value</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">env_key</span> = <span class="ruby-identifier">name</span>.<span class="ruby-identifier">upcase</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-string">&quot;-&quot;</span>, <span class="ruby-string">&quot;_&quot;</span>)
    <span class="ruby-identifier">env_key</span> = <span class="ruby-string">&quot;HTTP_&quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">env_key</span> <span class="ruby-keyword">unless</span> <span class="ruby-string">&quot;CONTENT_TYPE&quot;</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">env_key</span>
    <span class="ruby-identifier">converted_headers</span>[<span class="ruby-identifier">env_key</span>] = <span class="ruby-identifier">value</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">converted_headers</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-params_to_string" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">params_to_string</span><span
            class="method-args">(params)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="params_to_string-source">
            <pre><span class="ruby-comment"># File lib/rack/test.rb, line 303</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">params_to_string</span>(<span class="ruby-identifier">params</span>)
  <span class="ruby-keyword">case</span> <span class="ruby-identifier">params</span>
  <span class="ruby-keyword">when</span> <span class="ruby-constant">Hash</span> <span class="ruby-keyword">then</span> <span class="ruby-identifier">build_nested_query</span>(<span class="ruby-identifier">params</span>)
  <span class="ruby-keyword">when</span> <span class="ruby-keyword">nil</span>  <span class="ruby-keyword">then</span> <span class="ruby-string">&quot;&quot;</span>
  <span class="ruby-keyword">else</span> <span class="ruby-identifier">params</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-process_request" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">process_request</span><span
            class="method-args">(uri, env) { |last_response| ... }</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="process_request-source">
            <pre><span class="ruby-comment"># File lib/rack/test.rb, line 240</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">process_request</span>(<span class="ruby-identifier">uri</span>, <span class="ruby-identifier">env</span>)
  <span class="ruby-identifier">uri</span> = <span class="ruby-constant">URI</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-identifier">uri</span>)
  <span class="ruby-identifier">uri</span>.<span class="ruby-identifier">host</span> <span class="ruby-operator">||=</span> <span class="ruby-ivar">@default_host</span>

  <span class="ruby-ivar">@rack_mock_session</span>.<span class="ruby-identifier">request</span>(<span class="ruby-identifier">uri</span>, <span class="ruby-identifier">env</span>)

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">retry_with_digest_auth?</span>(<span class="ruby-identifier">env</span>)
    <span class="ruby-identifier">auth_env</span> = <span class="ruby-identifier">env</span>.<span class="ruby-identifier">merge</span>({
      <span class="ruby-string">&quot;HTTP_AUTHORIZATION&quot;</span>          =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">digest_auth_header</span>,
      <span class="ruby-string">&quot;rack-test.digest_auth_retry&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">true</span>
    })
    <span class="ruby-identifier">auth_env</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-string">&#39;rack.request&#39;</span>)
    <span class="ruby-identifier">process_request</span>(<span class="ruby-identifier">uri</span>.<span class="ruby-identifier">path</span>, <span class="ruby-identifier">auth_env</span>)
  <span class="ruby-keyword">else</span>
    <span class="ruby-keyword">yield</span> <span class="ruby-identifier">last_response</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">block_given?</span>

    <span class="ruby-identifier">last_response</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-retry_with_digest_auth-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">retry_with_digest_auth?</span><span
            class="method-args">(env)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="retry_with_digest_auth-3F-source">
            <pre><span class="ruby-comment"># File lib/rack/test.rb, line 277</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">retry_with_digest_auth?</span>(<span class="ruby-identifier">env</span>)
  <span class="ruby-identifier">last_response</span>.<span class="ruby-identifier">status</span> <span class="ruby-operator">==</span> <span class="ruby-value">401</span> <span class="ruby-operator">&amp;&amp;</span>
  <span class="ruby-identifier">digest_auth_configured?</span> <span class="ruby-operator">&amp;&amp;</span>
  <span class="ruby-operator">!</span><span class="ruby-identifier">env</span>[<span class="ruby-string">&quot;rack-test.digest_auth_retry&quot;</span>]
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
    </section>
  
  </section>
</main>


<footer id="validator-badges" role="contentinfo">
  <p><a href="http://validator.w3.org/check/referer">Validate</a>
  <p>Generated by <a href="http://rdoc.rubyforge.org">RDoc</a> 4.1.0.
  <p>Based on <a href="http://deveiate.org/projects/Darkfish-Rdoc/">Darkfish</a> by <a href="http://deveiate.org">Michael Granger</a>.
</footer>

